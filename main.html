<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è–èª•ç¦®ç‰©æ¥æ¥æ¨‚</title>
    <!-- å¼•å…¥ Tailwind CSS ç¢ºä¿éŸ¿æ‡‰å¼è¨­è¨ˆå’ŒåŸºæœ¬ç¾è§€ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* ä½¿ç”¨ Inter å­—é«” */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            background-color: #0b1a2c; /* æ·±å¤œè—èƒŒæ™¯ */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            overflow: hidden; /* é˜²æ­¢æ»¾å‹•æ¢å‡ºç¾ */
        }

        #game-container {
            width: 95vw;
            max-width: 600px;
            height: 80vh;
            max-height: 800px;
            background-color: #0d2138; /* ç¨æ·ºçš„æ·±è—è‰² */
            border-radius: 1rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5), 0 0 0 10px #e7e7e7;
            position: relative;
            overflow: hidden;
            border: 5px solid #ffcc33; /* é‡‘è‰²é‚Šæ¡† */
            display: flex;
            flex-direction: column;
        }

        #game-area {
            flex-grow: 1;
            position: relative;
            background-image:
                /* ç°¡æ˜“é›ªèŠ±æ•ˆæœ */
                radial-gradient(ellipse at 20% 20%, rgba(255, 255, 255, 0.7) 1px, transparent 0),
                radial-gradient(ellipse at 80% 60%, rgba(255, 255, 255, 0.5) 1px, transparent 0),
                radial-gradient(ellipse at 50% 90%, rgba(255, 255, 255, 0.8) 1px, transparent 0),
                radial-gradient(ellipse at 10% 70%, rgba(255, 255, 255, 0.4) 1px, transparent 0);
            background-size: 200px 200px;
        }

        #sleigh {
            position: absolute;
            bottom: 0;
            width: 80px;
            height: 40px;
            background-color: #c0392b; /* è–èª•ç´… */
            border-radius: 20px 20px 0 0;
            box-shadow: 0 4px #a93226, inset 0 -5px 0 rgba(255, 255, 255, 0.4);
            transition: left 0.05s linear; /* å¹³æ»‘ç§»å‹• */
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.5rem;
            color: white;
            z-index: 10;
        }
        /* é›ªæ©‡ä¸Šçš„ç™½è‰²çµ¨æ¯›è£é£¾ */
        #sleigh::before {
            content: "ğŸ…";
            position: absolute;
            top: -15px;
            font-size: 20px;
            line-height: 1;
        }
        
        .gift {
            position: absolute;
            top: 0;
            width: 30px;
            height: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 16px;
            animation: pulse 1s infinite alternate;
        }

        .gift.good {
            background-color: #2ecc71; /* ç¶ è‰²ç¦®ç‰© */
            border: 2px solid #27ae60;
        }
        .gift.bad {
            background-color: #7f8c8d; /* ç°è‰²ç…¤ç‚­ */
            border: 2px solid #6c7a7d;
            font-size: 20px;
        }

        /* è„ˆè¡å‹•ç•«ï¼Œè®“ç¦®ç‰©çœ‹èµ·ä¾†æ›´ç”Ÿå‹• */
        @keyframes pulse {
            from { transform: scale(1); }
            to { transform: scale(1.05); }
        }

        /* è¨Šæ¯å½ˆçª—æ¨£å¼ */
        #message-box {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 2rem;
            background-color: #fff;
            border-radius: 1rem;
            text-align: center;
            z-index: 20;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.8);
            border: 5px solid #c0392b;
        }

        .control-button {
            @apply px-6 py-3 m-2 text-white font-bold rounded-full transition-all duration-300 transform shadow-lg hover:scale-105;
            background-image: linear-gradient(135deg, #c0392b 0%, #e74c3c 100%);
        }
        .control-button:active {
             @apply scale-95;
             background-image: linear-gradient(135deg, #a93226 0%, #c0392b 100%);
        }
    </style>
</head>
<body class="bg-gray-900">

    <div id="game-container">
        <!-- é ‚éƒ¨è³‡è¨Šæ¬„ -->
        <div class="p-4 bg-yellow-600 text-white rounded-t-xl flex justify-between items-center shadow-md">
            <h1 class="text-2xl font-bold tracking-wider">è–èª•ç¦®ç‰©æ¥æ¥æ¨‚</h1>
            <div id="score-display" class="text-xl font-mono bg-yellow-700 px-4 py-1 rounded-full shadow-inner">
                åˆ†æ•¸: 0
            </div>
        </div>

        <!-- éŠæˆ²å€åŸŸ -->
        <div id="game-area">
            <!-- è–èª•é›ªæ©‡/æ¥å–å™¨ -->
            <div id="sleigh"></div>
        </div>

        <!-- æ‰‹æ©Ÿæ§åˆ¶æŒ‰éˆ• -->
        <div id="mobile-controls" class="p-4 flex justify-center space-x-4 bg-gray-800 rounded-b-xl md:hidden">
            <button class="control-button" onclick="moveSleigh('left')">
                <i class="fas fa-arrow-left"></i> &larr; å·¦ç§»
            </button>
            <button class="control-button" onclick="moveSleigh('right')">
                å³ç§» &rarr; <i class="fas fa-arrow-right"></i>
            </button>
        </div>

        <!-- è¨Šæ¯å½ˆçª— (éŠæˆ²é–‹å§‹/çµæŸ) -->
        <div id="message-box" class="hidden">
            <h2 id="message-title" class="text-3xl font-extrabold mb-4 text-gray-900">æ­¡è¿éŠç©ï¼</h2>
            <p id="message-content" class="text-gray-700 mb-6">
                ä½¿ç”¨éµç›¤çš„ **å·¦/å³ç®­é ­** æˆ–ä¸‹æ–¹çš„ **æŒ‰éˆ•** ä¾†ç§»å‹•è–èª•é›ªæ©‡ï¼Œæ¥ä½ç¦®ç‰© (ğŸ)ï¼Œé¿é–‹ç…¤ç‚­ (âš«)ï¼
            </p>
            <button id="start-button" class="px-8 py-4 bg-green-500 text-white font-bold text-xl rounded-lg shadow-xl hover:bg-green-600 transition-colors transform hover:scale-105" onclick="startGame()">
                é–‹å§‹éŠæˆ²
            </button>
        </div>
    </div>

    <script>
        // --- éŠæˆ²è¨­å®š ---
        const GAME_SPEED = 20; // éŠæˆ²è¿´åœˆæ›´æ–°é–“éš” (æ¯«ç§’)
        const GIFT_FALL_RATE = 2; // ç¦®ç‰©ä¸‹é™é€Ÿåº¦ (åƒç´ /å¹€)
        const CATCHER_MOVE_STEP = 20; // é›ªæ©‡ç§»å‹•æ­¥é•· (åƒç´ )
        const GIFT_SPAWN_RATE = 1500; // ç¦®ç‰©ç”Ÿæˆé–“éš” (æ¯«ç§’)
        const MAX_MISSES = 5; // æœ€å¤§å…è¨±éŒ¯éçš„ç¦®ç‰©æ•¸

        // --- DOM å…ƒç´  ---
        const gameArea = document.getElementById('game-area');
        const sleigh = document.getElementById('sleigh');
        const scoreDisplay = document.getElementById('score-display');
        const messageBox = document.getElementById('message-box');
        const messageTitle = document.getElementById('message-title');
        const messageContent = document.getElementById('message-content');
        const startButton = document.getElementById('start-button');
        const mobileControls = document.getElementById('mobile-controls');

        // --- éŠæˆ²ç‹€æ…‹ ---
        let score = 0;
        let missedCount = 0;
        let isGameRunning = false;
        let gameLoopInterval = null;
        let giftSpawnTimeout = null;
        let sleighX = 0;
        const fallingGifts = [];

        /**
         * åˆå§‹åŒ–éŠæˆ²è¨­ç½®å’Œç‹€æ…‹ã€‚
         */
        function initializeGame() {
            // è®“é›ªæ©‡åˆå§‹ä½æ–¼ä¸­å¤®
            const gameAreaWidth = gameArea.clientWidth;
            const sleighWidth = sleigh.offsetWidth;
            sleighX = (gameAreaWidth - sleighWidth) / 2;
            sleigh.style.left = `${sleighX}px`;

            // èª¿æ•´æ‰‹æ©Ÿæ§åˆ¶æŒ‰éˆ•çš„å¯è¦‹æ€§
            if (window.innerWidth < 768) {
                mobileControls.style.display = 'flex';
            } else {
                mobileControls.style.display = 'none';
            }
            
            // ã€ä¿®æ­£ã€‘ç¢ºä¿éŠæˆ²é–‹å§‹/çµæŸè¨Šæ¯æ¡†åœ¨éŠæˆ²è¼‰å…¥æ™‚é¡¯ç¤º
            messageBox.classList.remove('hidden');
        }

        /**
         * å•Ÿå‹•éŠæˆ²ã€‚
         */
        function startGame() {
            if (isGameRunning) return;

            // é‡è¨­ç‹€æ…‹
            score = 0;
            missedCount = 0;
            updateScoreDisplay();
            isGameRunning = true;
            messageBox.classList.add('hidden'); // éš±è—è¨Šæ¯æ¡†
            
            // æ¸…é™¤èˆŠç¦®ç‰©
            fallingGifts.forEach(gift => gift.element.remove());
            fallingGifts.length = 0;

            // å•Ÿå‹•éŠæˆ²è¿´åœˆå’Œç¦®ç‰©ç”Ÿæˆ
            gameLoopInterval = setInterval(gameLoop, GAME_SPEED);
            spawnGiftLoop();
        }

        /**
         * çµæŸéŠæˆ²ä¸¦é¡¯ç¤ºçµæœã€‚
         */
        function endGame() {
            isGameRunning = false;
            clearInterval(gameLoopInterval);
            clearTimeout(giftSpawnTimeout);

            messageTitle.textContent = "éŠæˆ²çµæŸï¼";
            messageContent.innerHTML = `æ‚¨çš„æœ€çµ‚å¾—åˆ†æ˜¯ï¼š<span class="text-red-600 font-extrabold text-4xl">${score}</span> åˆ†ã€‚<br> æº–å‚™å¥½å†ç©ä¸€å±€ï¼Œå°‡ç¦®ç‰©é€çµ¦å…¨ä¸–ç•Œäº†å—ï¼Ÿ`;
            startButton.textContent = "å†ç©ä¸€æ¬¡";
            messageBox.classList.remove('hidden'); // é¡¯ç¤ºè¨Šæ¯æ¡†
        }

        /**
         * æ›´æ–°åˆ†æ•¸é¡¯ç¤ºã€‚
         */
        function updateScoreDisplay() {
            scoreDisplay.textContent = `åˆ†æ•¸: ${score} | éŒ¯é: ${missedCount}/${MAX_MISSES}`;
            if (missedCount >= MAX_MISSES) {
                endGame();
            }
        }

        /**
         * éŠæˆ²çš„ä¸»è¿´åœˆï¼šæ›´æ–°ä½ç½®ã€æª¢æŸ¥ç¢°æ’ã€‚
         */
        function gameLoop() {
            if (!isGameRunning) return;

            const sleighRect = sleigh.getBoundingClientRect();
            const gameAreaHeight = gameArea.clientHeight;

            // è¿­ä»£æ‰€æœ‰æ‰è½çš„ç¦®ç‰©
            for (let i = fallingGifts.length - 1; i >= 0; i--) {
                const gift = fallingGifts[i];
                const giftElement = gift.element;
                gift.y += GIFT_FALL_RATE;
                giftElement.style.top = `${gift.y}px`;

                // æª¢æŸ¥æ˜¯å¦æ¥ä½ (ç¢°æ’)
                if (gift.y + giftElement.offsetHeight >= sleighRect.top) {
                    const giftRect = giftElement.getBoundingClientRect();

                    // æª¢æŸ¥æ°´å¹³æ–¹å‘æ˜¯å¦æœ‰é‡ç–Š
                    if (giftRect.left < sleighRect.right && giftRect.right > sleighRect.left) {
                        // ç¢°æ’ç™¼ç”Ÿï¼
                        if (gift.type === 'good') {
                            score += 10;
                        } else {
                            // æ¥åˆ°ç…¤ç‚­ï¼Œæ‰£åˆ†
                            score = Math.max(0, score - 5);
                            sleigh.style.backgroundColor = '#d35400'; // é–ƒçˆæ©˜è‰²è¡¨ç¤ºæ‡²ç½°
                            setTimeout(() => sleigh.style.backgroundColor = '#c0392b', 100);
                        }
                        
                        giftElement.remove();
                        fallingGifts.splice(i, 1);
                        updateScoreDisplay();
                    }
                }

                // æª¢æŸ¥æ˜¯å¦éŒ¯é (æ‰åˆ°åº•éƒ¨)
                if (gift.y > gameAreaHeight) {
                    if (gift.type === 'good') {
                        missedCount++;
                    } else {
                        // éŒ¯éç…¤ç‚­ï¼Œä¸æ‡²ç½°
                    }
                    giftElement.remove();
                    fallingGifts.splice(i, 1);
                    updateScoreDisplay();
                }
            }
        }

        /**
         * åœ¨éš¨æ©Ÿä½ç½®ç”Ÿæˆæ–°çš„ç¦®ç‰©æˆ–ç…¤ç‚­ã€‚
         */
        function spawnGift() {
            const isGood = Math.random() < 0.8; // 80% ç¦®ç‰©, 20% ç…¤ç‚­
            const type = isGood ? 'good' : 'bad';
            const content = isGood ? 'ğŸ' : 'âš«';
            
            const giftElement = document.createElement('div');
            giftElement.className = `gift ${type}`;
            giftElement.textContent = content;

            const gameAreaWidth = gameArea.clientWidth;
            const giftWidth = 30; // ç¦®ç‰©å¯¬åº¦
            
            // éš¨æ©Ÿç”Ÿæˆ X åº§æ¨™
            const x = Math.random() * (gameAreaWidth - giftWidth);
            
            giftElement.style.left = `${x}px`;
            giftElement.style.top = '0px';

            gameArea.appendChild(giftElement);
            
            fallingGifts.push({
                element: giftElement,
                x: x,
                y: 0,
                type: type
            });
        }

        /**
         * å¾ªç’°ç”Ÿæˆç¦®ç‰©ï¼Œä¸¦é€æ¼¸åŠ å¿«é€Ÿåº¦ã€‚
         */
        function spawnGiftLoop() {
            if (!isGameRunning) return;

            spawnGift();

            // æ ¹æ“šåˆ†æ•¸èª¿æ•´ç”Ÿæˆé€Ÿåº¦ (æœ€å¿« 500ms)
            let spawnDelay = Math.max(500, GIFT_SPAWN_RATE - (score * 5)); 
            
            giftSpawnTimeout = setTimeout(spawnGiftLoop, spawnDelay);
        }

        /**
         * ç§»å‹•è–èª•é›ªæ©‡ã€‚
         * @param {string} direction 'left' æˆ– 'right'
         */
        function moveSleigh(direction) {
            if (!isGameRunning) return;

            const gameAreaWidth = gameArea.clientWidth;
            const sleighWidth = sleigh.offsetWidth;

            if (direction === 'left') {
                sleighX = Math.max(0, sleighX - CATCHER_MOVE_STEP);
            } else if (direction === 'right') {
                sleighX = Math.min(gameAreaWidth - sleighWidth, sleighX + CATCHER_MOVE_STEP);
            }

            sleigh.style.left = `${sleighX}px`;
        }

        /**
         * è™•ç†éµç›¤è¼¸å…¥ï¼Œç”¨æ–¼æ¡Œé¢ç©å®¶ã€‚
         */
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowLeft') {
                e.preventDefault();
                moveSleigh('left');
            } else if (e.key === 'ArrowRight') {
                e.preventDefault();
                moveSleigh('right');
            }
        });

        // è™•ç†è¦–çª—å¤§å°æ”¹è®Šï¼Œç¢ºä¿éŸ¿æ‡‰å¼
        window.addEventListener('resize', initializeGame);

        // é é¢åŠ è¼‰å®Œæˆå¾Œåˆå§‹åŒ–éŠæˆ²
        window.onload = initializeGame;

    </script>
</body>
</html>
